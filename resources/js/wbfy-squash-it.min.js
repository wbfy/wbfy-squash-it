!function(r){var n=3;function s(e){var a=r(".wbfy-squash-it-now #wbfy-si-log"),n=r(".wbfy-squash-it-now #wbfy-si-dry_run").is(":checked")?"yes":"no";e.preventDefault(),r(".wbfy-squash-it-now #wbfy-si-log").show().html(""),r(".wbfy-squash-it-now #wbfy-si-dry_run, .wbfy-squash-it-now #submit").prop("disabled",!0),c(a,"Querying server for file list"),c(a,"This can take a few minutes if you have uploaded a lot of images so please be patient"),c(a,"If you navigate away during this process Squash It! won&#39;t update any images"),"yes"==n&&c(a,"** Dry run mode is enabled so no files will be modified **","info"),r.get({url:ajaxurl,data:{action:"wbfy_si_files",verify:r("#wbfy-si-verify").val()},cache:!1,timeout:0}).done(function(e){var s=e.data;if("OK"!==s.status)return c(a,s.status,"error"),void d();var i=parseInt(s.files.count).toLocaleString("en"),t=parseFloat(s.secs).toLocaleString("en"),o=Object.keys(s.files.list);0<s.files.count?(s.batch_mode.on&&(c(a,"** Using batch mode for a maximum of "+s.batch_mode.limit+" files per run **","info"),c(a,"** Enable setting of PHP_OPTION max_execution_time on the server to prevent batch mode **","info")),c(a,"Found "+i+" files in "+o.length+" folders in "+t+" seconds"),l(o,s.files,a,n)):c(a,"No files found","error")}).fail(function(e,s,i){c(a,'There was a problem fetching the filelist. The server said "'+s+", "+i+'". Please try again later.',"error"),d()})}function l(i,t,e,s){var o=l;if(void 0!==e&&(o.total=t.count,o.processed=1,o.success=0,o.dir=0,o.file=0,o.started=Date.now(),o.dryRun=s,o.$log=e,o.retryCount=n,o.sizes={original:0,squashed:0}),o.dir>=i.length&&0==o.file&&o.retryCount==n)return"yes"==o.dryRun?(c(o.$log,"Dry running Squash It! scanned a total of "+o.total+" images in "+u(o.started)+" seconds","success"),o.success!=o.total&&c(o.$log,o.success+" images could be squashed","success"),c(o.$log,"Current total space used for images: "+f(o.sizes.original),"success indent"),c(o.$log,"Projected space used after Squashing It!: "+f(o.sizes.squashed),"success indent"),c(o.$log,"Projected space saved: "+f(o.sizes.original-o.sizes.squashed),"success indent"),o.success!=o.total&&c(o.$log,o.total-o.success+" images would be left unsquashed - see log details for more information","success indent"),c(o.$log,"** No files were modified as dry run mode was enabled **","success info")):(c(o.$log,"Squash It! processed a total of "+o.total+" images in "+u(o.started)+" seconds","success"),o.success!=o.total&&c(o.$log,o.success+" images were squashed","success"),c(o.$log,"Original total space used for images: "+f(o.sizes.original),"success indent"),c(o.$log,"Space used after Squashing It!: "+f(o.sizes.squashed),"success indent"),c(o.$log,"Space saved: "+f(o.sizes.original-o.sizes.squashed),"success indent"),o.success!=o.total&&c(o.$log,o.total-o.success+" images were left unsquashed - see log details for more information","success indent")),void d();0==o.file&&o.retryCount==n&&c(o.$log,"Processing "+t.list[i[o.dir]].length+" files in "+i[o.dir]);var a=t.list[i[o.dir]][o.file];o.retryCount==n&&c(o.$log,o.processed+"/"+o.total+" -> "+a.name+" ["+a.size.width+" x "+a.size.height+" "+f(a.size.bytes)+"] #"+a.id),r.get({url:ajaxurl,data:{action:"wbfy_si_file",verify:r("#wbfy-si-verify").val(),path:i[o.dir],filename:a.name,id:a.id,dry_run:o.dryRun},cache:!1,timeout:0}).done(function(e){var s=e.data;o.file++,o.processed++,o.success++,o.file>=t.list[i[o.dir]].length&&(o.file=0,o.dir++),l.retryCount=3,"OK"==s.status?(o.sizes.original+=s.sizes.original,o.sizes.squashed+=s.sizes.squashed):c(o.$log,s.status,"error"),l(i,t)}).fail(function(e,s){0<o.retryCount?o.retryCount--:(o.file++,o.file>=t.list[i[o.dir]].length&&(o.file=0,o.dir++),o.retryCount=n,o.processed++,c(o.$log,"Request failed after "+n+" retries. The file could not be Squashed.","error indent")),l(i,t)})}function u(e){return parseFloat((Date.now()-e)/1e3).toLocaleString("en")}function c(e,s,i){var t="";t=void 0!==i?r("<div>",{class:(" "+i).replace(new RegExp(" ","g")," wbfy-si-").trim()}):r("<div>"),e.append(t.html(s))}function d(){r(".wbfy-squash-it-now #wbfy-si-dry_run, .wbfy-squash-it-now #submit").prop("disabled",!1)}function f(e){return(parseInt(e)/1024/1e3).toLocaleString("en")+"MB"}r(document).ready(function(){if(r(".wbfy-squash-it-now #submit").click(s),window.MutationObserver){var e=document.querySelector(".wbfy-squash-it-now #wbfy-si-log");new MutationObserver(function(){e.scrollTop=e.scrollHeight}).observe(e,{childList:!0})}})}(jQuery);